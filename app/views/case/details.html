{% extends "layout.html" %}
{% set title = 'Personal details' %}
{% block pageTitle %}{{ title }}{% endblock %}

{% block beforeContent %}
{{ govukBreadcrumbs({
  items: [
    {
      text: "Cases",
      href: "/cases"
    },
    {
      text: case.serviceUserPersonalDetails.name,
      href: "/cases/" + CRN
    },
    {
      text: title
    }
  ]
}) }}
{% endblock %}

{% block content %}

{% include "case/_case-service-user-banner.html" %}

{% set currentNavSection = 'details' %}
{% include "case/_case-nav.html" %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <h1 class="govuk-heading-l govuk-!-margin-bottom-7">{{title}}</h1>
  </div>
</div>


<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    {% set personalDetails %}
      {% set dateOfBirthAndAge %}
        {{ case.serviceUserPersonalDetails.dateOfBirth | dateWithYear }} ({{ yearsSince(case.serviceUserPersonalDetails.dateOfBirth) }} years
      old)
      {% endset %}

      {{ govukSummaryList({
        rows: [
          {
            key: { text: "Name" },
            value: { text: case.serviceUserPersonalDetails.name }
          },
          {
            key: { text: "Preferred name/Known as" },
            value: { text: case.serviceUserPersonalDetails.preferredNameKnownAs }
          } if case.serviceUserPersonalDetails.preferredNameKnownAs,
          {
            key: { text: "Aliases" },
            value: { text: case.serviceUserPersonalDetails.aliases.join(', ') | default('<span class="govuk-hint-s">None known</span>', true) | safe }
          },
          {
            key: { text: "Date of birth" },
            value: { text: dateOfBirthAndAge }
          },
          {
            key: { text: "Preferred language" },
            value: { text: case.serviceUserPersonalDetails.preferredLanguage }
          },
          {
            key: { text: "Disabilities and adjustments" },
            value: { text: case.serviceUserPersonalDetails.disabilitiesAndAdjustments.join(', ') | default('<span class="govuk-hint-s">None known</span>', true) | safe }
          },
          {
            key: { text: "PNC" },
            value: { html: case.PNC }
          },
          {
            key: { text: "CRN" },
            value: { html: case.CRN }
          }
        ]
      }) }}

      <p class="govuk-!-margin-bottom-0 govuk-!-margin-top-4 govuk-body-s govuk-hint-s">
        Last updated 6 January 2021
      </p>
    {% endset %}

    {{ appSummaryCard({
      titleText: "Personal details",
      classes: 'govuk-!-margin-bottom-6',
      html: personalDetails,
      actions: {
        items: [
          {
            href: "/cases/" + CRN + "/personal-details",
            text: "View all personal details"
          }
        ]
      }
    }) }}

    {% set contactDetails %}
      {{ govukSummaryList({
        rows: [
          {
            key: { text: "Phone number" },
            value: { html: case.serviceUserPersonalDetails.phone }
          },
          {
            key: { text: "Email address" },
            value: { html: case.serviceUserPersonalDetails.email }
          }
        ]
      }) }}
    {% endset %}

    {{ appSummaryCard({
      titleText: "Contact details",
      classes: 'govuk-!-margin-bottom-6',
      html: contactDetails,
      actions: {
        items: [
          {
            href: "#",
            text: "Change in Delius"
          }
        ]
      }
    }) }}

    <h3 class="govuk-heading-m">Addresses</h3>

    {% set mainAddress %}
      {{ govukSummaryList({
        rows: [
          {
            key: { text: "Address" },
            value: { html: case.serviceUserPersonalDetails.mainAddress.address.join('<br>') }
          } if case.serviceUserPersonalDetails.mainAddress,
          {
            key: { text: "Telephone" },
            value: { html: case.serviceUserPersonalDetails.mainAddress.telephoneNumber }
          },
          {
            key: { text: "Type of address" },
            value: { html: case.serviceUserPersonalDetails.mainAddress.type + (' (verified)' if case.serviceUserPersonalDetails.mainAddress.typeVerified else ' (not verified)') }
          },
          {
            key: { text: "Start date" },
            value: { html: case.serviceUserPersonalDetails.mainAddress.startDate | dateWithYear }
          },
          {
            key: { text: "Notes" },
            value: { html: case.serviceUserPersonalDetails.mainAddress.notes | nl2br }
          }
        ]
      }) }}
    {% endset %}

    {% if case.serviceUserPersonalDetails.mainAddress %}
      {{ appSummaryCard({
        titleText: "Main address",
        classes: 'govuk-!-margin-bottom-6',
        html: mainAddress,
        actions: {
          items: [
            {
              href: "#",
              text: "Change in Delius"
            }
          ]
        }
      }) }}
    {% endif %}

    <div class="govuk-!-margin-bottom-7">

      {% if case.personalContacts.length > 0 %}
        <p class="govuk-body">
          <a href="/cases/{{ CRN }}/address-book-personal">View all personal contacts ({{ case.personalContacts.length }})</a>
        </p>
      {% endif %}

      <p class="govuk-body-s govuk-hint-s">
        Last updated 15 March 2021
      </p>
    </div>

    <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

    <div class="govuk-!-margin-bottom-7">
      <h2 class="govuk-heading-m">
        Circumstances
      </h2>

      {{ govukSummaryList({
        classes: 'govuk-summary-list--no-border',
        rows: [
          {
            key: { text: "Employment status" },
            value: { text: case.serviceUserPersonalDetails.circumstances.employment }
          },
          {
            key: { text: "Housing status" },
            value: { text: case.serviceUserPersonalDetails.circumstances.housingStatus }
          },
          {
            key: { text: "Safeguarding issues" },
            value: { text: case.serviceUserPersonalDetails.circumstances.safeguardingIssues.join(', ') or 'None' }
          }
        ]
        }) }}

      <p class="govuk-body">
        <a href="#">
          View all circumstances
        </a>
      </p>
      <p class="govuk-body-s govuk-hint-s">
        Last updated 10 March 2021
      </p>
    </div>

  </div>


  <div class="govuk-grid-column-one-third">

    <h2 class="govuk-heading-m">Personal documents</h2>

    {% set documents = case.currentOrder.personalDocuments %}
    {% include "case/_case-documents.html" %}

  </div>

</div>

{% endblock %}
