{% extends "layout.html" %}
{% set title = 'Sentence' %}
{% block pageTitle %}{{ title }}{% endblock %}

{% block beforeContent %}
{{ govukBreadcrumbs({
  items: [
    {
      text: "Cases",
      href: "/cases"
    },
    {
      text: case.serviceUserPersonalDetails.name,
      href: "/cases/" + CRN
    },
    {
      text: title
    }
  ]
}) }}
{% endblock %}

{% block content %}

{% include "case/_case-service-user-banner.html" %}

{% set currentNavSection = 'sentence' %}
{% include "case/_case-nav.html" %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <h1 class="govuk-heading-l govuk-!-margin-bottom-7">Sentence</h1>
  </div>
</div>

{% set offence %}
  {{ govukSummaryList({
    rows: [
      {
        key: { text: "Main category" },
        value: { text: "Other summary offences (excluding motoring) - 19500" }
      },
      {
        key: { text: "Sub category" },
        value: { text: "Using violence to secure entry (Criminal Law Act/CJ and Public Order Act) - 19563" }
      },
      {
        key: { text: "Offence date" },
        value: { text: "2021-01-01" | dateWithYear }
      },
      {
        key: { text: "Count" },
        value: { text: "1" }
      },
      {
        key: { text: "Notes" },
        value: { text: "No notes" }
      }
    ]
  }) }}
{% endset %}

{{ appSummaryCard({
  titleText: 'Offence',
  classes: 'govuk-!-margin-bottom-6 app-summary-card--large-title',
  html: offence
}) }}

{% set conviction %}
  {{ govukSummaryList({
    rows: [
      {
        key: { text: "Court" },
        value: { text: "Antrim Crown Court" }
      },
      {
        key: { text: "Responsible court" },
        value: { text: "Antrim Crown Court" }
      },
      {
        key: { text: "Conviction date" },
        value: { text: "2021-02-02" | dateWithYear }
      },
      {
        key: { text: "Sentenced on" },
        value: { text: "2021-03-03" | dateWithYear }
      }
    ]
  }) }}
{% endset %}

{{ appSummaryCard({
  titleText: 'Conviction',
  classes: 'govuk-!-margin-bottom-6 app-summary-card--large-title',
  html: conviction
}) }}

{% set sentence %}
  {{ govukSummaryList({
    rows: [
      {
        key: { text: "Order" },
        value: { text: "Community order" }
      },
      {
        key: { text: "Length" },
        value: { text: "24 months" }
      },
      {
        key: { text: "Start date" },
        value: { text: "2021-04-04" | dateWithYear }
      },
      {
        key: { text: "End date" },
        value: { text: "2023-04-04" | dateWithYear }
      }
    ]
  }) }}
{% endset %}

{{ appSummaryCard({
  titleText: 'Sentence',
  classes: 'govuk-!-margin-bottom-6 app-summary-card--large-title',
  html: sentence
}) }}

{% set requirements %}
  {{ govukSummaryList({
    rows: [
      {
        key: { text: "Requirement" },
        value: { text: "Rehabilitation Activity Requirement (RAR)" }
      },
      {
        key: { text: "Length" },
        value: { text: "30 days" }
      },
      {
        key: { text: "Imposed (Sentence) date" },
        value: { text: "2021-04-04" | dateWithYear }
      },
      {
        key: { text: "Notes" },
        value: { text: "No notes" }
      }
    ]
  }) }}
{% endset %}

{{ appSummaryCard({
  titleText: 'Requirements',
  classes: 'govuk-!-margin-bottom-6 app-summary-card--large-title',
  html: requirements
}) }}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <div class="govuk-!-margin-bottom-7">
      <h2 class="govuk-heading-m">
        Offences
      </h2>
      <p class="govuk-body">{{ case.currentOrder.description }}</p>

      {% set detailsHtml %}
        {{ govukSummaryList({
          classes: 'govuk-summary-list--no-border',
          rows: [
            {
              key: { text: "Offence date" },
              value: { html: case.currentOrder.offenceDate | dateWithYear }
            },
            {
              key: { text: "Conviction date" },
              value: { html: case.currentOrder.convictionDate | dateWithYear }
            },
            {
              key: { text: "Court" },
              value: { html: case.currentOrder.court }
            },
            {
              key: { text: "Responsible court" },
              value: { html: case.currentOrder.responsibleCourt }
            }
          ]
        }) }}
      {% endset %}

      {{ govukDetails({
        summaryText: "View offence details",
        html: detailsHtml
      }) }}

      <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

      <h2 class="govuk-heading-m">
        Sentence details
      </h2>
      {{ govukSummaryList({
        classes: 'govuk-summary-list--no-border',
        rows: [
          {
            key: { text: "Sentence" },
            value: { html: case.currentOrder.type }
          },
          {
            key: { text: "Length" },
            value: { html: case.currentOrder.lengthInMonths + ' months' }
          },
          {
            key: { text: "Start date" },
            value: { html: case.currentOrder.startDate | dateWithYear }
          },
          {
            key: { text: "End date" },
            value: { html: case.currentOrder.endDate | dateWithYear }
          },
          {
            key: { text: "Time elapsed" },
            value: { html: case.currentOrder.progressInMonths + ' months elapsed (of ' + case.currentOrder.lengthInMonths + ' months)' }
          }
        ]
      }) }}
    </div>
    <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
    <div class="govuk-!-margin-bottom-7">
      <h3 class="govuk-heading-m">
        Requirements
      </h3>
      <dl class="govuk-summary-list govuk-summary-list--no-border">
        {% for _, requirement in case.currentOrder.requirements %}
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              {{ requirement.type }}
            </dt>
            <dd class="govuk-summary-list__value">
              {{ requirement.value }}
            </dd>
          </div>
        {% endfor %}
      </dl>
    </div>
  </div><!--END COL TWO THIRDS-->

  <div class="govuk-grid-column-one-third">
    <h2 class="govuk-heading-m">Court documents</h2>

    {% set documents = case.currentOrder.courtDocuments %}
    {% include "case/_case-documents.html" %}

    <h2 class="govuk-heading-m">
      Probation history
    </h2>

    <div class="app-card app-card--blue govuk-!-margin-bottom-6">
      <strong>Probation status</strong><br>
      {{ case.status }}
    </div>

    <p class="govuk-body">
      <ul class="govuk-list">
        <li>
          <span class="govuk-tag govuk-tag--grey">{{ case.breachesCount }}</span> Breaches
        </li>
        <li>
          <span class="govuk-tag govuk-tag--grey">{{ case.restrainingOrdersCount }}</span> Restraining orders
        </li>
      </ul>
    </p>

    {% if case.previousOrders.length > 0 %}
    <p class="govuk-body">
      <a class="govuk-heading-s govuk-!-margin-top-0 govuk-!-margin-bottom-1" href="/cases/{{ CRN }}/previous-orders">Previous orders ({{ case.previousOrders.length }})</a>
      Last ended on {{ case.previousOrders[0].endDate | dateWithYearShortMonth }}
    </p>
    {% endif %}

    {% if case.professionalContacts.length > 0 %}
      <p class="govuk-body">
        <a class="govuk-heading-s" href="/cases/{{ CRN }}/address-book-professional">Previous professional contacts ({{ case.professionalContacts.length }})</a>
      </p>
    {% endif %}
  </div>
</div>
{% endblock %}
