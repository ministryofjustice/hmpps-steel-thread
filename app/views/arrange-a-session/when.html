{% extends "_wizard-form.html" %}
{% set title = 'When will the appointment be?' %}

{% block form %}
  <h1 class="govuk-heading-xl govuk-!-margin-bottom-6">
    {{ title }}
  </h1>

  {% set circumstancesHTML %}
    <p class="govuk-body">
      <strong>Preferred language</strong><br>
      {{ case.serviceUserPersonalDetails.preferredLanguage }}
    </p>
    <p class="govuk-body">
      <strong>Disabilities and adjustments</strong><br>
      {{ case.serviceUserPersonalDetails.disabilitiesAndAdjustments.join(', ') | default('<span class="govuk-hint-s">None known</span>', true) | safe }}
    </p>
    <p class="govuk-body">
      <strong>Employment status</strong><br>
      {{ case.serviceUserPersonalDetails.circumstances.employment }}
    </p>
  {% endset %}

  {{ govukDetails({
    summaryText: case.serviceUserPersonalDetails.firstName + "’s circumstances",
    html: circumstancesHTML
  }) }}

  {{ govukDateInput({
    id: 'session-date',
    fieldset: {
      legend: {
        text: "Date",
        classes: "govuk-label--s"
      }
    },
    items: [
      {
        name: '[communication][' + CRN + '][' + sessionId + '][session-date-day]',
        value: appointment['session-date-day'],
        classes: "govuk-input--width-2",
        label: 'Day'
      },
      {
        name: '[communication][' + CRN + '][' + sessionId + '][session-date-month]',
        value: appointment['session-date-month'],
        classes: "govuk-input--width-2",
        label: 'Month'
      },
      {
        name: '[communication][' + CRN + '][' + sessionId + '][session-date-year]',
        value: appointment['session-date-year'],
        classes: "govuk-input--width-4",
        label: 'Year'
      }
    ],
    hint: {
      text: "For example, 20 5 2021"
    }
  }) }}

  <div class="govuk-form-group app-time-autocomplete">
    <div class="autocomplete">
      <label class="govuk-label govuk-!-font-weight-bold" for="session-start-time">
        Time
      </label>
      <input
        class="govuk-input govuk-input--width-5 time-field time-from"
        type="text"
        id="session-start-time"
        name="[communication][{{CRN}}][{{sessionId}}][session-start-time]"
        value="{{ appointment['session-start-time'] }}">
    </div>
    <span class="govuk-body" style="margin:0 0.75rem 0 0.75rem;">to</span>
    <div class="autocomplete">
      <input
        class="govuk-input govuk-input--width-5 time-field time-from"
        type="text"
        id="session-end-time"
        name="[communication][{{CRN}}][{{sessionId}}][session-end-time]"
        value="{{ appointment['session-end-time'] }}">
    </div>
  </div>

  {% set repeatingHtml %}
    {{ govukRadios({
      fieldset: {
        legend: {
          text: "How frequently will it repeat?",
          classes: "govuk-label--s"
        }
      },
      items: [
        {
          text: "Weekly"
        },
        {
          text: "Every 2 weeks"
        },
        {
          text: "Monthly"
        }
      ]
    } | decorateFormAttributes(['communication', CRN, sessionId, 'repeating-frequency'])) }}

    {{ govukInput({
      label: {
        text: "Number of repeat appointments",
        classes: "govuk-label--s"
      },
      classes: "govuk-input--width-3"
    } | decorateFormAttributes(['communication', CRN, sessionId, 'repeating-count'])) }}
  {% endset %}

  {{ govukRadios({
    fieldset: {
      legend: {
        text: "Will this be a repeating appointment?",
        classes: "govuk-label--m"
      }
    },
    items: [
      {
        text: "Yes",
        conditional: {
          html: repeatingHtml
        }
      },
      {
        text: "No, it’s a one-off appointment"
      }
    ]
  } | decorateFormAttributes(['communication', CRN, sessionId, 'repeating'])) }}
{% endblock %}
